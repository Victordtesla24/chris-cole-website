## Root Cause Analysis – Frontend Error “No valid birth time candidates found”

| # | Root Cause | Evidence (Logs/Code) | End-to-End Error Trail (User → UI/X → API → BTR Phases 0…8 → UI/UX → User) | Impacted Files |
| --- | --- | --- | --- | --- |
| 1 | BPHS strict mode rejects every candidate: `strict_bphs=True` enforces 0.5° orb and 0.2° padekyata tolerance while scanning 720 two‑minute steps, so all times were discarded (182 padekyata failures + 538 non‑human trine classifications) and Phase 7 returned 404. | `logs/backend.log` 18:17:36–18:18:09 shows Phase 6 start with `strict_bphs: True`, progress for 720/720 steps, Phase 7 “No candidates” and 404; `backend/main.py:524` sets strict search config; `backend/main.py:565` raises the 404 detail surfaced to the UI; strict tolerances defined in `backend/btr_core.py:33` and enforced in `backend/btr_core.py:676`. | User enters DOB 1985-10-24 & Pune → UI form submission posts to `/api/btr` (`frontend/app.js:1` request builder) → API begins BTR (Phase 0) and runs Phases 1–5 successfully → Phase 6 search with strict filters rejects all 720 candidates (`logs/backend.log` Phase 6 progress) → Phase 7 “No candidates” 404 emitted with message → `frontend/app.js:64-83` handles non-OK response and displays `error-message` → User sees “No valid birth time candidates found…”. | `frontend/app.js:1`, `frontend/app.js:64`, `backend/main.py:524`, `backend/main.py:565`, `backend/btr_core.py:33`, `backend/btr_core.py:676`, `logs/backend.log` |
| 2 | Sunrise/sunset (and derived Gulika) computed for the previous day (1985-10-23 instead of 1985-10-24), skewing ishta-kala, pranapada, Gulika selection, and purification anchors, further ensuring candidates miss the strict BPHS filters. | `logs/backend.log` Phase 4 shows `sunrise_local='1985-10-23T06:31:45.200502'` and `sunset_local='1985-10-23T18:05:56.274645'` even though DOB is 1985-10-24; `backend/btr_core.py:207` computes rise/set from local midnight JD, which returns the prior day’s events at +5:30; reproductions show `compute_sunrise_sunset(1985-10-24, Pune)` -> 1985-10-23 times while `compute_sunrise_sunset(1985-10-25, …)` yields 1985-10-24 times. | User submits form (same as above) → UI posts to `/api/btr` (`frontend/app.js:1`) → API Phase 3 sets window 00:00–23:59 → Phase 4 loads sunrise/sunset for the prior day (`logs/backend.log` Phase 4) → Phase 5 Gulika uses that prior-day sunrise, feeding wrong Gulika/pranapada inputs into Phase 6 hard filters → Phase 6 rejects all candidates → Phase 7 returns 404 → UI surfaces backend detail (`frontend/app.js:64-83`) → User sees the error. | `frontend/app.js:1`, `frontend/app.js:64`, `backend/main.py:500`, `backend/btr_core.py:207`, `backend/btr_core.py:259`, `logs/backend.log` |

## Root Cause Analysis Table (RCAT) for Zero Candidate Fix Implementation

| RCAT ID | Failure Scenario | Root Cause | Evidence & Impact | Solution Required |
| --- | --- | --- | --- | --- |
| 2.i | Dynamic Question Failure | Frontend shows generic RecoveryPanel; backend doesn't analyze input gaps to suggest specific questions | Current RecoveryPanel.tsx shows static suggestions regardless of input context; `_summarize_rejections_for_response()` returns rejection stats but no structured questions based on missing fields | Backend must analyze input completeness and return prioritized `suggested_questions` array; frontend must display dynamic questions |
| 2.ii.a | Zero Candidate Failure (minimal input) | Full-day search with strict BPHS may reject all candidates; missing time constraints reduce search effectiveness | DOB=1985-10-24, POB=Pune, Career events only, no time range → default window 00:00-23:59 with strict BPHS filters rejects all 720 candidates; no input analysis to guide user | Add input gap analysis to suggest time range as high-priority question; improve fallback logic |
| 2.ii.b | Zero Candidate Failure (time range only) | Narrow time window + strict filters may have no valid candidates; missing traits/events reduce scoring confidence | DOB=1985-10-24, POB=Pune, time_range_override (e.g., 11:00-15:00), Career events only, no traits → narrow window + strict BPHS = zero candidates; no guidance on missing traits | Backend should suggest adding physical traits to improve scoring when time range is provided but still no candidates |

